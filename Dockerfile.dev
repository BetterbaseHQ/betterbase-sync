FROM rust:1.88-bookworm

RUN cargo install --locked cargo-watch

WORKDIR /app

COPY Cargo.toml Cargo.lock ./
COPY bins ./bins
COPY crates ./crates
RUN cargo fetch --locked

COPY docker/dev-entrypoint.sh /usr/local/bin/less-sync-dev-entrypoint
RUN chmod +x /usr/local/bin/less-sync-dev-entrypoint

ENV CARGO_TARGET_DIR=/tmp/less-sync-rs-target

EXPOSE 5379

CMD ["/usr/local/bin/less-sync-dev-entrypoint"]
